<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Bản đồ hành chính Việt Nam sau sáp nhập</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      #tooltip {
        position: absolute;
        display: none;
        background-color: white;
        border: 1px solid #ccc;
        padding: 8px;
        z-index: 10;
        font-size: 16px;
        pointer-events: none;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      #tooltip .tooltip-header {
        background-color: #333;
        color: white;
        padding: 6px 10px;
        font-weight: bold;
        border-radius: 4px 4px 0 0;
        margin: -8px -8px 8px -8px;
      }

      #map-container {
        flex: 1;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        border: #ccc 1px solid;
        background-color: #f9f9f9;
      }

      #vietnam-svg-wrapper {
        position: relative;
        width: 100%;
        max-width: 1200px;
        height: auto;
        overflow: hidden;
      }

      #vietnam-svg-wrapper svg {
        width: 100%;
        height: 100%;
        object-fit: contain;
        touch-action: none;
        cursor: grab;
        display: block;
      }

      svg path:hover {
        fill: #ff008c !important;
        cursor: pointer;
        transition: fill 0.3s ease, stroke 0.3s ease;
        stroke: #ff008c; /* Màu viền */
        stroke-width: 2px; /* Độ dày viền */
      }

      svg path {
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      svg path:focus {
        outline: none;
      }

      #zoom-controls {
        position: absolute;
        top: 80px;
        right: 10px;
        display: flex;
        flex-direction: column;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        z-index: 20;
      }

      #zoom-controls button {
        width: 40px;
        height: 40px;
        font-size: 24px;
        font-weight: bold;
        background: white;
        border: none;
        cursor: pointer;
        outline: none;
        transition: background 0.2s ease;
        padding: 0;
      }

      #zoom-controls button:hover {
        background: #f0f0f0;
      }

      #zoom-controls button:active {
        background: #e0e0e0;
      }

      #logo {
        position: absolute;
        top: 10px;
        right: 40px;
      }

      #logo img {
        width: 90px;
        height: auto;
      }
      .island-label {
        position: absolute;
        color: red;
        font-size: 14px;
        font-weight: bold;
        background-color: rgba(255, 255, 255, 0.7);
        padding: 2px 6px;
        border-radius: 4px;
        pointer-events: none;
        z-index: 5;
      }
    </style>
  </head>

  <body>
    <div id="vietnam-svg-wrapper">
      <div class="island-label" style="width: 800px; height: 800px">
        QĐ Hoàng Sa
      </div>
      <div class="island-label" style="top: 88%; left: 82%">QĐ Trường Sa</div>
    </div>
    <div id="tooltip"></div>

    <div id="zoom-controls">
      <button id="zoomInBtn">+</button>
      <button id="zoomOutBtn">−</button>
    </div>

    <script src="data.js"></script>
    <script>
      const tooltip = document.getElementById("tooltip");
      const panZoomWrapper = document.getElementById("vietnam-svg-wrapper");
      let scale = 1,
        originX = 0,
        originY = 0;
      let isDragging = false,
        startX,
        startY;
      let touchStartDistance = 0;

      fetch("vietnam.svg")
        .then((res) => res.text())
        .then((svg) => {
          document.getElementById("vietnam-svg-wrapper").innerHTML = svg;

          const svgDoc = document.querySelector("#vietnam-svg-wrapper svg");

          const masks = svgDoc.querySelectorAll("mask[id]");
          const maskIds = Array.from(masks).map((mask) => mask.id);
          maskIds.forEach((maskId) => {
            if (provinceData[maskId]) {
            } else {
            }
          });

          masks.forEach(function (mask) {
            mask.addEventListener("mousemove", function (e) {
              const id = mask.id;
              const info = provinceData[id];
              if (!info) {
                tooltip.innerHTML = `<div class="tooltip-header">Không có dữ liệu</div>
            <span>Vui lòng chọn tỉnh/thành khác.</span>`;
              } else {
                tooltip.innerHTML = `<div class="tooltip-header">${info.name}</div>
            ${info.description}`;
              }
              tooltip.style.left = e.pageX + 10 + "px";
              tooltip.style.top = e.pageY + 10 + "px";
              tooltip.style.display = "block";
            });
            mask.addEventListener("mouseleave", function () {
              tooltip.style.display = "none";
            });
          });

          const provinces = svgDoc.querySelectorAll("path");
          provinces.forEach(function (path) {
            const id = path.getAttribute("id");
            const info = provinceData[path.getAttribute("id")];
            if (info && info.color) {
              path.setAttribute("fill", info.color);
            }

            path.addEventListener("mousemove", function (e) {
              const id = path.getAttribute("id");
              const info = provinceData[id];

              if (!info) {
                tooltip.innerHTML = `<div class="tooltip-header">Không có dữ liệu</div>
                <span>Vui lòng chọn tỉnh/thành khác.</span>`;
                tooltip.style.left = e.pageX + 10 + "px";
                tooltip.style.top = e.pageY + 10 + "px";
                tooltip.style.display = "block";
                return;
              }

              const formattedPopulation = info.population
                .toString()
                .replace(/\B(?=(\d{3})+(?!\d))/g, ".");
              const formattedArea = info.area
                .toString()
                .replace(/\B(?=(\d{3})+(?!\d))/g, ".");

              const provinceValues = Object.values(provinceData);

              const populationRank =
                provinceValues
                  .slice() // clone array
                  .sort((a, b) => b.population - a.population) // giảm dần
                  .findIndex((p) => p === info) + 1;

              const areaRank =
                provinceValues
                  .slice() // clone array
                  .sort((a, b) => {
                    const areaA = parseFloat(
                      a.area.toString().replace(",", ".")
                    );
                    const areaB = parseFloat(
                      b.area.toString().replace(",", ".")
                    );
                    return areaB - areaA; // giảm dần
                  })
                  .findIndex((p) => p === info) + 1;

              tooltip.innerHTML = `
              <div class="tooltip-header">${info.name}</div>
              ${info.description}<br>
              <strong>Diện tích:</strong> ${formattedArea} km² (xếp thứ ${areaRank} toàn quốc)<br>
              <strong>Dân số:</strong> ${formattedPopulation} người (xếp thứ ${populationRank} toàn quốc)
            `;
              tooltip.style.left = e.pageX + 10 + "px";
              tooltip.style.top = e.pageY + 10 + "px";
              tooltip.style.display = "block";
            });

            path.addEventListener("mouseleave", function () {
              tooltip.style.display = "none";
            });
          });
        });

      // ZOOM
      panZoomWrapper.addEventListener("wheel", function (e) {
        e.preventDefault();
        const zoomIntensity = 0.1;
        const delta = e.deltaY < 0 ? 1 + zoomIntensity : 1 - zoomIntensity;
        scale *= delta;
        scale = Math.min(Math.max(scale, 0.5), 10);
        panZoomWrapper.querySelector(
          "svg"
        ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
      });

      // PAN (drag)
      panZoomWrapper.addEventListener("mousedown", function (e) {
        isDragging = true;
        startX = e.clientX - originX;
        startY = e.clientY - originY;
        panZoomWrapper.style.cursor = "grabbing";
      });

      document.addEventListener("mousemove", function (e) {
        if (!isDragging) return;
        originX = e.clientX - startX;
        originY = e.clientY - startY;
        panZoomWrapper.querySelector(
          "svg"
        ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
      });

      document.addEventListener("mouseup", function () {
        isDragging = false;
        panZoomWrapper.style.cursor = "grab";
      });

      // Touch events
      panZoomWrapper.addEventListener("touchstart", function (e) {
        if (e.touches.length === 1) {
          isDragging = true;
          startX = e.touches[0].clientX - originX;
          startY = e.touches[0].clientY - originY;
        } else if (e.touches.length === 2) {
          touchStartDistance = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
          );
        }
      });

      panZoomWrapper.addEventListener("touchmove", function (e) {
        if (e.touches.length === 1 && isDragging) {
          originX = e.touches[0].clientX - startX;
          originY = e.touches[0].clientY - startY;
          panZoomWrapper.querySelector(
            "svg"
          ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
        } else if (e.touches.length === 2) {
          const touchMoveDistance = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
          );
          const zoomFactor = touchMoveDistance / touchStartDistance;
          scale *= zoomFactor;
          scale = Math.min(Math.max(scale, 0.5), 10);
          panZoomWrapper.querySelector(
            "svg"
          ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
          touchStartDistance = touchMoveDistance;
        }
      });

      panZoomWrapper.addEventListener("touchend", function () {
        isDragging = false;
      });

      document
        .getElementById("zoomInBtn")
        .addEventListener("click", function () {
          scale *= 1.2;
          scale = Math.min(scale, 10);
          panZoomWrapper.querySelector(
            "svg"
          ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
        });

      document
        .getElementById("zoomOutBtn")
        .addEventListener("click", function () {
          scale /= 1.2;
          scale = Math.max(scale, 0.5);
          panZoomWrapper.querySelector(
            "svg"
          ).style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
        });
    </script>
  </body>
</html>
